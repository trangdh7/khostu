@model List<Webkho_20241021.Models.khotongs>
@{
    ViewData["Title"] = "Tongkho";
    Layout = "~/Areas/TruongBPKetoan/Views/Layout/Layout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="~/CSS/Action.css" rel="stylesheet" />
    <link href="~/CSS/Kho.css" rel="stylesheet" />
    <link href="~/CSS/style.css" rel="stylesheet" />
    <link href="~/CSS/Table.css" rel="stylesheet" />
    <link href="~/CSS/Tongkho.css" rel="stylesheet" />
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <title>Quản Lý Kho</title>
</head>
<body>
    <div class="warehouse-container">
        <!-- Header -->
        <div class="warehouse-header">
            <div class="header-content">
                <h1 class="header-title">
                    <i class='bx bx-package'></i> Quản Lý Kho
                </h1>
                <p class="header-subtitle">Quản lý tồn kho và cấp phát vật tư</p>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="warehouse-nav">
            <div class="nav-tabs">
                @{
                    var action = (string)ViewContext.RouteData.Values["action"];
                }
                <a href="/TruongBPKetoan/Home/Tongkho" class="nav-tab @(action == "Tongkho" ? "active" : "")">
                    <i class='bx bx-store'></i> Tổng kho
                </a>
                <a href="/TruongBPKetoan/Home/VatTuMoi" class="nav-tab @(action == "VatTuMoi" ? "active" : "")">
                    <i class='bx bx-package'></i> Kho nv mới
                </a>
                <a href="/TruongBPKetoan/Home/KhoDuAn" class="nav-tab @(action == "KhoDuAn" ? "active" : "")">
                    <i class='bx bx-briefcase'></i> Kho dự án
                </a>
            </div>
            <div class="nav-search">
                <form method="get" action="/TruongBPKetoan/Home/Tongkho" style="display:flex; align-items:center; gap:8px;">
                    <i class='bx bx-search'></i>
                    <input type="text" name="q" value="@ViewBag.Q" placeholder="Tìm kiếm vật tư..." />
                    <button type="submit" class="btn btn-primary">Tìm</button>
                </form>
            </div>
        </div>

        <!-- Success Alert -->
        @if (TempData["Success"] != null)
        {
            <div id="success-alert" class="alert alert-success">
                <div class="alert-content">
                    <i class='bx bx-check-circle'></i>
                    <div>
                        <strong>Thành công!</strong>
                        <p>@TempData["Success"]</p>
                    </div>
                </div>
                <button class="alert-close" onclick="this.parentElement.style.display='none';">
                    <i class='bx bx-x'></i>
                </button>
            </div>
        }

        <!-- Action Buttons -->
        <div class="action-section top-action">
            <div class="action-group">
                <h3>Hành động</h3>
                <div class="button-group">
                    <a href="~/TruongBPKetoan/Home/Themthietbi" class="btn btn-primary">
                        <i class='bx bx-plus'></i> Thêm vật tư
                    </a>
                    
                    <a href="@Url.Action("ExportTongkho", "Home", new { area = "TruongBPKetoan", q = ViewBag.Q })" class="btn btn-info">
                        <i class='bx bx-download'></i> Export
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="warehouse-content">
            <div class="table-section">
                <div class="table-header">
                    <h2>Danh sách vật tư tổng kho</h2>
                </div>
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Mã vật tư</th>
                                <th>Tên vật tư</th>
                                <th>Mã kho</th>
                                <th>Hãng SX</th>
                                <th>Nhà cung cấp</th>
                                <th>Dự án</th>
                                <th>Số lượng</th>
                                <th>Đơn vị</th>
                                <th>Ngày nhập kho</th>
                                <th>Ngày bảo hành</th>
                                <th>Thời gian BH</th>
                                <th>Trạng thái</th>
                                <th>Loại cấp phát</th>
                                
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null && Model.Any())
                            {
                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td>@(item.MaSanpham ?? "-")</td>
                                        <td>@item.TenSanpham</td>
                                        <td>@item.Makho</td>
                                        <td>@item.HangSX</td>
                                        <td>@item.NhaCC</td>
                                        <td>@item.DuAn</td>
                                        <td>@item.SL</td>
                                        <td>@item.DonVi</td>
                                        <td>@item.NgayNhapkho?.ToString("dd/MM/yyyy")</td>
                                        <td>@item.NgayBaohanh?.ToString("dd/MM/yyyy")</td>
                                        <td>@item.ThoiGianBH?.ToString("dd/MM/yyyy")</td>
                                        <td>@item.TrangThai</td>
                                        <td>@item.LoaiCapPhat</td>
                                        
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="14">Không có dữ liệu.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <div class="pagination">
                        @{
                            int totalPage = (int)(ViewBag.TotalPages ?? 1); int curr = (int)(ViewBag.Page ?? 1); var _q = (string)(ViewBag.Q ?? ""); var _qParam = string.IsNullOrEmpty(_q) ? "" : "&q=" + System.Net.WebUtility.UrlEncode(_q);
                        }
                        @if (totalPage > 1)
                        {
                            for (int i = 1; i <= totalPage; i++)
                            {
                                if (i == curr)
                                {
                                    <span class="active">@i</span>
                                }
                                else
                                {

                                    <a href="?page=@i@Html.Raw(_qParam)">@i</a>
                                }
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="~/js/khotong.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const alert = document.getElementById("success-alert");
            if (alert) {
                setTimeout(() => {
                    alert.style.animation = "fadeOut 0.5s ease forwards";
                    setTimeout(() => alert.style.display = "none", 500);
                }, 5000); // 5 giây
            }
        });
    </script>

</body>
</html>
